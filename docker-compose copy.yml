services:
  lightrag:
    container_name: lightrag
    image: ghcr.io/hkuds/lightrag:latest
    build:
      context: .
      dockerfile: Dockerfile
      tags:
        - ghcr.io/hkuds/lightrag:latest
    ports:
      - "${PORT:-9621}:9621"
    volumes:
      - ./data/rag_storage:/app/data/rag_storage
      - ./data/inputs:/app/data/inputs
      - ./config.ini:/app/config.ini
      - ./.env:/app/.env
    env_file:
      - .env
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
      - "ollama.host:host-gateway"
      - "docker.host:0.0.0.0"
    depends_on:
      - neo4j
      - mongodb
      - redis
      - memgraph
      - postgres

  neo4j:
    image: neo4j:5
    container_name: lightrag_neo4j
    ports:
      - "7474:7474"   # HTTP
      - "7687:7687"   # BOLT
    environment:
      - NEO4J_AUTH=neo4j/password123
    volumes:
      - neo4j_data:/data
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
      - "ollama.host:host-gateway"
      - "docker.host:0.0.0.0"

  mongodb:
    image: mongo:6
    container_name: lightrag_mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
      - "ollama.host:host-gateway"
      - "docker.host:0.0.0.0"

  redis:
    image: redis:7
    container_name: lightrag_redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
      - "ollama.host:host-gateway"
      - "docker.host:0.0.0.0"

  memgraph:
    image: memgraph/memgraph:latest
    container_name: lightrag_memgraph
    ports:
      - "7688:7687"  # host 7688 -> container 7687 (Bolt)
      - "3001:3000"  # Memgraph Lab (host 3001 -> container 3000)
    volumes:
      - memgraph_data:/var/lib/memgraph
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
      - "ollama.host:host-gateway"
      - "docker.host:0.0.0.0"

  postgres:
    image: postgres:15
    container_name: lightrag_postgres
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=lightrag
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
      - "ollama.host:host-gateway"
      - "docker.host:0.0.0.0"

volumes:
  neo4j_data: {}
  mongo_data: {}
  redis_data: {}
  memgraph_data: {}
  postgres_data: {}
